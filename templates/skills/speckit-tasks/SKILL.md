
---
name: speckit-tasks
description: Generate executable, dependency-ordered tasks.md file for feature based on available design documents.
license: MIT
compatibility: Requires speckit workflow.
metadata:
  author: speckit
  version: "1.0"
---

基于可用的设计文档，为功能特性生成可执行的、按依赖关系排序的 tasks.md 文件。

## 用户输入

```
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。用户可以提供**任意数量**的额外参考文档或指令：
- **多个参考文档**：本地路径、代码文件、设计文档、外部链接
- **特定扩写指令**："为所有数据库操作增加性能监控任务"
- **任务粒度偏好**：请求更细致或更粗略的任务拆分

## 概述

1. **设置**：从仓库根目录运行 `.specify/scripts/bash/create-new-feature.sh --json`。解析 FEATURE_DIR 和 AVAILABLE_DOCS。所有路径必须是绝对的。同时也应考虑 $ARGUMENTS 中提到的**所有外部文档**。

2. **加载设计文档**：从 FEATURE_DIR 及用户输入读取：
   - **必需**：plan.md（技术栈、库、结构），spec.md（带优先级的用户故事）
   - **可选**：data-model.md、contracts/、research.md、quickstart.md
   - **外部输入**：任何通过 $ARGUMENTS 提供的**补充参考文档**

3. **执行任务生成工作流**：
   - 加载 plan.md 并提取技术栈、库、项目结构
   - 加载 spec.md 并提取带优先级的用户故事（P1、P2、P3...）
   - **多文档集成**：从多个文档交叉提取技术实现步骤
   - 如果存在 data-model.md：提取实体并映射到用户故事
   - 如果存在 contracts/：将端点映射到用户故事
   - 如果存在 research.md：提取设置的决策
   - **多源任务扩写**：结合所有输入文档将用户故事细化为原子可执行任务
   - 按用户故事生成任务
   - 创建显示用户故事完成顺序的依赖关系图
   - 验证任务完整性

4. **生成 tasks.md**：使用 `.specify/templates/tasks-template.md` 作为结构：
   - 阶段 1：设置（项目初始化）
   - 阶段 2：基础（阻塞先决条件）
   - 阶段 3+：每个用户故事作为一个阶段（P1、P2、P3... 按优先级顺序）
     - 每个阶段包括：故事目标、独立测试标准、测试任务（如果请求）、实施任务
     - 清晰的 [Story] 标签（US1、US2、US3...）
     - 每个故事内可并行任务的 [P] 标记
     - 每个故事阶段后的检查点标记
   - 最终阶段：完善与横切关注点
   - 按执行顺序编号的任务（T001、T002...）
   - 每个任务的清晰文件路径
   - 显示故事完成顺序的依赖关系部分
   - 实施策略部分（MVP 优先，增量交付）

5. **报告**：输出 tasks.md 路径和摘要：
   - 总任务数
   - 每个用户故事的任务数
   - 识别的并行机会
   - 每个故事的独立测试标准
   - 建议的 MVP 范围

## 任务格式（必需）

每个任务必须严格遵循此格式：

```markdown
- [ ] [TaskID] [P?] [Story?] 带文件路径的描述
```

**格式组件：**

1. **复选框**：始终以 `- [ ]` 开头
2. **任务 ID**：按执行顺序的序号（T001、T002...）
3. **[P] 标记**：仅当任务可并行化时包含
4. **[Story] 标签**：仅用户故事阶段任务需要
   - 格式：[US1]、[US2]、[US3]...（映射到 spec.md）
   - 设置阶段：无故事标签
   - 基础阶段：无故事标签
   - 用户故事阶段：必须有故事标签
   - 完善阶段：无故事标签
5. **描述**：带确切文件路径的清晰操作

**示例：**

- ✅ 正确：`- [ ] T001 根据实施计划创建项目结构`
- ✅ 正确：`- [ ] T005 [P] 在 src/middleware/auth.py 中实现认证中间件`
- ✅ 正确：`- [ ] T012 [P] [US1] 在 src/models/user.py 中创建用户模型`
- ✅ 正确：`- [ ] T014 [US1] 在 src/services/user_service.py 中实现 UserService`
- ❌ 错误：`- [ ] 创建用户模型`（缺少 ID 和故事标签）
- ❌ 错误：`T001 [US1] 创建模型`（缺少复选框）

## 任务组织

1. **来自用户故事**（主要组织方式）：
   - 每个用户故事（P1、P2、P3...）都有自己的阶段
   - 将所有相关组件映射到它们的 stories：
     - 故事所需的模型
     - 故事所需的服务
     - 故事所需的端点
     - 故事特定的测试（如果请求）
   - 标记故事依赖关系（大多数故事应该是独立的）

2. **来自合约**：
   - 每个合约/端点 → 映射到它服务的用户故事
   - 如果请求测试：每个合约 → 在该故事阶段的实现之前的合约测试任务 [P]

3. **来自数据模型**：
   - 每个实体 → 映射到需要它的用户故事
   - 如果实体服务多个故事：放在最早的故事或基础阶段

4. **来自设置/基础设施**：
   - 共享基础设施 → 设置阶段（阶段 1）
   - 基础/阻塞任务 → 基础阶段（阶段 2）
   - 故事特定的设置 → 在该故事的阶段内

## 阶段结构

- **阶段 1**：设置（项目初始化）
- **阶段 2**：基础（阻塞先决条件）
- **阶段 3+**：按优先级顺序的用户故事（P1、P2、P3...）
  - 每个故事内：测试 → 模型 → 服务 → 端点 → 集成
- **最终阶段**：完善与横切关注点

tasks.md 应该立即可执行——每个任务必须足够具体，以便 LLM 可以在没有额外上下文的情况下完成它。
